function e(e,t){if(!Array.isArray(e))return[];const n=t?.multiple?new Set(Array.from(t.selectedOptions).map(e=>e.value)):new Set([t?.value]);return e.map(e=>{const t=e.value??"";return{value:t,label:e.label??String(t),selected:"boolean"==typeof e.selected?e.selected:n.has(t),disabled:Boolean(e.disabled),group:e.group??null,element:null}})}function t(t,n={}){return Array.isArray(n.data)?e(n.data,t):function(e){const t=[];return e.querySelectorAll("option").forEach(e=>{t.push({value:e.value,label:e.textContent,selected:e.selected,disabled:e.disabled,group:"OPTGROUP"===e.parentElement?.tagName?e.parentElement.label:null,element:e})}),t}(t)}let n=0;function s(e){return n+=1,`${e}-${n}`}function l(e,t,n={}){e.dispatchEvent(new CustomEvent(t,{detail:n,bubbles:!0}))}let a=!1,o=!1;function r(e,t,n,l=null){const a=l||{};var o,r;if(l?a.menu.innerHTML="":(a.wrapper=document.createElement("div"),a.wrapper.className="dropdown fxd-select",o=a.wrapper,(r=n.wrapperClass)&&r.split(" ").forEach(e=>{e&&o.classList.add(e)}),a.control=document.createElement("div"),a.control.className="d-flex align-items-center gap-1",a.button=document.createElement("button"),a.button.type="button",a.button.className=n.buttonClass,a.button.setAttribute("role","combobox"),a.button.setAttribute("aria-haspopup","listbox"),a.button.setAttribute("aria-expanded","false"),a.control.appendChild(a.button),n.clearable&&!e.multiple&&(a.clearButton=document.createElement("button"),a.clearButton.type="button",a.clearButton.className=n.clearButtonClass,a.clearButton.setAttribute("aria-label",n.clearButtonLabel),a.clearButton.textContent=n.clearButtonText,a.control.appendChild(a.clearButton)),a.menu=document.createElement("div"),a.menu.className=n.menuClass,a.wrapper.appendChild(a.control),a.wrapper.appendChild(a.menu),e.parentNode.insertBefore(a.wrapper,e.nextSibling)),a.list=document.createElement("div"),a.list.id=a.list.id||s("fxd-list"),a.list.setAttribute("role","listbox"),a.button.setAttribute("aria-controls",a.list.id),n.searchable){const e=document.createElement("div"),t=document.createElement("div"),s=document.createElement("input");if(t.className="form-control form-control-sm w-auto d-flex flex-fill align-items-center p-1 m-1",s.className="form-control p-0 border-0 rounded-0 shadow-none",s.placeholder=n.filterPlaceholder,s.setAttribute("aria-label",n.filterPlaceholder),t.appendChild(s),n.searchClearable){const e=document.createElement("button");e.type="button",e.className=`fxd-search-clear ${n.searchClearButtonClass}`,e.setAttribute("aria-label",n.searchClearAriaLabel),e.textContent=n.searchClearIcon,t.appendChild(e),a.searchClearButton=e}if(a.clearButton&&a.clearButton.parentNode&&a.clearButton.parentNode!==a.control&&(a.clearButton.parentNode.removeChild(a.clearButton),a.control.appendChild(a.clearButton)),e.appendChild(t),a.menu.appendChild(e),a.searchInput=s,n.showDivider){const e=document.createElement("hr");e.className="m-0",a.menu.appendChild(e)}a.noResults=document.createElement("div"),a.noResults.className="no-result text-muted px-2 small d-none",a.noResults.textContent=n.noResultsText,a.menu.appendChild(a.noResults)}n.maxHeight&&"auto"!==n.maxHeight&&(a.list.style.overflowY="auto",a.list.style.maxHeight=n.maxHeight),a.menu.appendChild(a.list),a.optionButtons=[];let i=null;t.forEach(e=>{if(e.group&&e.group!==i){const t=document.createElement("div");t.className="dropdown-header",t.textContent=e.group,t.dataset.group=e.group,a.list.appendChild(t),i=e.group}e.group||(i=null);const t=document.createElement("button");if(t.type="button",t.className="dropdown-item fxd-item",t.textContent=e.label,t.dataset.value=e.value,t.dataset.group=e.group||"",t.disabled=e.disabled,t.setAttribute("role","option"),t.setAttribute("aria-selected",e.selected?"true":"false"),t.id=s("fxd-opt"),n.renderOption){const s=n.renderOption(e,{selected:e.selected,disabled:e.disabled});s instanceof HTMLElement?(t.innerHTML="",t.appendChild(s)):"string"==typeof s&&(t.innerHTML=s)}if(e.selected&&t.classList.add("is-selected"),n.showCheckmark&&""!==e.value){const e=document.createElement("span");e.className=n.checkmarkClass,e.setAttribute("aria-hidden","true"),e.textContent=n.checkmarkText,t.appendChild(e)}a.optionButtons.push(t),a.list.appendChild(t)}),function(e,t,n,s){if("function"==typeof n.renderValue){const l=n.renderValue(t,s);return l instanceof HTMLElement?(e.button.innerHTML="",void e.button.appendChild(l)):void(e.button.innerHTML=l??"")}const l=t.filter(e=>e.selected);if(0!==l.length){if(s.multiple){if("pills"===n.multiValueStyle){const t=document.createElement("span");t.className=n.pillContainerClass;const s=Math.max(0,n.maxDisplayItems)+1,a=l.slice(0,Math.min(l.length,s));a.forEach(e=>{const s=document.createElement("span");s.className=n.pillClass,s.textContent=e.label,t.appendChild(s)});const o=l.length-a.length;if(o>0){const e=document.createElement("span");e.className=n.selectionCountClass;const s=n.selectionCountTemplate;e.textContent="function"==typeof s?s(o):`${o} selected`,t.appendChild(e)}return e.button.innerHTML="",void e.button.appendChild(t)}if("count"===n.multiValueStyle){const t=n.selectionCountTemplate,s="function"==typeof t?t(l.length):`${l.length} selected`;return void(e.button.innerHTML=`<span class="${n.selectionCountClass}">${s}</span>`)}const t=Math.max(0,n.maxDisplayItems)+1;if(l.length>t){const s=l.length-t,a=n.selectionCountTemplate;return void(e.button.textContent="function"==typeof a?a(s):`${s} selected`)}return void(e.button.textContent=l.map(e=>e.label).join(", "))}e.button.textContent=l[0].label}else e.button.textContent=n.placeholder}(a,t,n,e);const c=e.disabled;return a.button.disabled=c,a.clearButton&&(a.clearButton.disabled=c),a.searchInput&&(a.searchInput.disabled=c),a.searchClearButton&&(a.searchClearButton.disabled=c),a}function i(e,t){return!e||t.label.toLowerCase().includes(e.toLowerCase())}function c(t){const{selectEl:n,ui:s,options:a,state:o}=t,r=()=>Array.from(s.list.querySelectorAll("button.dropdown-item")).filter(e=>!e.classList.contains("d-none")&&!e.disabled),c=e=>{const t=r();if(0===t.length)return o.focusedIndex=-1,void s.button.removeAttribute("aria-activedescendant");const n=Math.max(0,Math.min(e,t.length-1));t.forEach(e=>e.classList.remove("active"));const l=t[n];l.classList.add("active"),l.scrollIntoView({block:"nearest"}),o.focusedIndex=n,s.button.setAttribute("aria-activedescendant",l.id)},u=()=>{const e=r();if(0===e.length)return;const t=e.findIndex(e=>"true"===e.getAttribute("aria-selected"));c(t>=0?t:0)},d=e=>{n.disabled||(e.preventDefault(),t.toggle(),t.state.open&&(u(),s.searchInput?.select()))},p=e=>{s.wrapper.contains(e.target)||t.close()},h=e=>{const l=e.target.closest("button.dropdown-item");if(l&&!n.disabled&&!l.disabled)if(n.multiple){e.preventDefault(),e.stopPropagation();const s=Array.from(n.options).find(e=>e.value===l.dataset.value);s&&(s.selected=!s.selected),n.dispatchEvent(new Event("change",{bubbles:!0})),requestAnimationFrame(()=>t.open())}else n.value=l.dataset.value,n.dispatchEvent(new Event("change",{bubbles:!0})),t.close(),s.button.focus()},m=e=>{const t=e.target.closest("button.dropdown-item");if(!t)return;const n=r().indexOf(t);n>=0&&c(n)},f=()=>{t.refresh(),l(n,"fxd:change")};let b=null;const v=async s=>{const l=await(a.load?.(s));if(!Array.isArray(l))return;const o=e(l,n);!function(e,t){const n=new Map;e.innerHTML="",t.forEach(t=>{let s=e;if(t.group){if(!n.has(t.group)){const s=document.createElement("optgroup");s.label=t.group,n.set(t.group,s),e.appendChild(s)}s=n.get(t.group)}const l=document.createElement("option");l.value=t.value,l.textContent=t.label,l.disabled=Boolean(t.disabled),l.selected=Boolean(t.selected),s.appendChild(l)})}(n,o),t.model=o,t.refresh(),t.ui.searchInput&&(t.ui.searchInput.value=s)},E=e=>{const n=e.target.value;if(t.state.query=n,a.load)return b&&clearTimeout(b),void(b=setTimeout(()=>v(n),a.loadDebounce));const l=a.filter||i,o=function(e,t,n){const s=new Map;let l=0,a=0;return Array.from(e.children).forEach(e=>{if(e.classList.contains("dropdown-header"))return void s.set(e.dataset.group||"",{header:e,visible:0});if(!e.matches("button.dropdown-item"))return;const o={label:e.textContent},r=n(t,o);e.classList.toggle("d-none",!r),r||(l+=1),r&&(a+=1);const i=e.dataset.group||"";s.has(i)&&r&&(s.get(i).visible+=1)}),s.forEach(({header:e,visible:t})=>{e.classList.toggle("d-none",0===t)}),{hidden:l,visible:a}}(s.list,n,l);s.noResults&&s.noResults.classList.toggle("d-none",o.visible>0),u()},C=e=>{if(n.disabled)return;const l=e.key;if(!t.state.open&&["ArrowDown","ArrowUp","Enter"," "].includes(l))return e.preventDefault(),t.open(),u(),void s.searchInput?.select();if(t.state.open){if("Escape"===l)return e.preventDefault(),t.close(),void s.button.focus();if("Enter"===l){e.preventDefault();const t=r()[o.focusedIndex];return void(t&&t.click())}if(" "===l){e.preventDefault();const t=r()[o.focusedIndex];return void(t&&t.click())}if(["ArrowDown","ArrowUp","Home","End"].includes(l)){e.preventDefault();const t=r();if(0===t.length)return;if("Home"===l)return void c(0);if("End"===l)return void c(t.length-1);const n="ArrowDown"===l?1:-1;c(o.focusedIndex+n)}}},g=e=>{e.preventDefault(),t.clear()},x=()=>{s.searchInput&&(s.searchInput.value="",s.searchInput.dispatchEvent(new Event("input")),s.searchInput.select())};return s.button.addEventListener("click",d),s.list.addEventListener("click",h),s.list.addEventListener("mousemove",m),document.addEventListener("click",p),n.addEventListener("change",f),s.searchInput?.addEventListener("input",E),s.searchClearButton?.addEventListener("click",x),s.wrapper.addEventListener("keydown",C),s.clearButton?.addEventListener("click",g),()=>{s.button.removeEventListener("click",d),s.list.removeEventListener("click",h),s.list.removeEventListener("mousemove",m),document.removeEventListener("click",p),n.removeEventListener("change",f),s.searchInput?.removeEventListener("input",E),s.searchClearButton?.removeEventListener("click",x),s.wrapper.removeEventListener("keydown",C),s.clearButton?.removeEventListener("click",g)}}class u{constructor(e,n={}){if(!e||"SELECT"!==e.tagName)throw new Error("FxdSelect requires a <select> element");this.selectEl=e,this.options={...u.defaults,...n},this.state={open:!1,query:"",focusedIndex:-1},this.model=t(this.selectEl,this.options),this.ui=r(this.selectEl,this.model,this.options),this.cleanup=c(this),this.selectEl.classList.add("d-none"),this.options.warnOnMissingBootstrap&&function(e=5){if(a||o)return;if("undefined"==typeof window||"undefined"==typeof document)return;const t=()=>{if(o=!1,a)return;const t=getComputedStyle(document.documentElement),n=t.getPropertyValue("--bs-body-color").trim(),s=t.getPropertyValue("--bs-body-bg").trim();n.length>0||s.length>0||console.warn(`fxd-select: Bootstrap ${e}.x styles not detected. The component will still work, but you should provide your own styles.`),a=!0};o=!0,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>requestAnimationFrame(t),{once:!0}):requestAnimationFrame(t)}(this.options.bootstrapMajor),l(this.selectEl,"fxd:init")}_syncOpenState(e){this.state.open=e,e?(this.ui.wrapper.classList.add("show"),this.ui.menu.classList.add("show"),this.ui.button.setAttribute("aria-expanded","true")):(this.ui.wrapper.classList.remove("show"),this.ui.menu.classList.remove("show"),this.ui.button.setAttribute("aria-expanded","false"),this.ui.button.removeAttribute("aria-activedescendant"),this.state.focusedIndex=-1)}open(){this.state.open||(this._syncOpenState(!0),l(this.selectEl,"fxd:open"))}close(){this.state.open&&(this._syncOpenState(!1),l(this.selectEl,"fxd:close"))}toggle(){this.state.open?this.close():this.open()}refresh(){const e=this.state.open;this.cleanup?.(),this.model=t(this.selectEl,this.options),this.ui=r(this.selectEl,this.model,this.options,this.ui),this.cleanup=c(this),this._syncOpenState(e),this.ui.searchInput&&this.state.query&&(this.ui.searchInput.value=this.state.query,this.ui.searchInput.dispatchEvent(new Event("input"))),l(this.selectEl,"fxd:refresh")}destroy(){this.cleanup?.(),this.ui.wrapper.remove(),this.selectEl.classList.remove("d-none"),l(this.selectEl,"fxd:destroy")}getValue(){return this.selectEl.value}setValue(e){this.selectEl.value=e,this.selectEl.dispatchEvent(new Event("change",{bubbles:!0}))}clear(){this.selectEl.multiple?Array.from(this.selectEl.options).forEach(e=>{e.selected=!1}):this.selectEl.value="",this.selectEl.dispatchEvent(new Event("change",{bubbles:!0}))}}u.defaults={searchable:!0,clearable:!1,maxHeight:"12em",placeholder:"Select...",noResultsText:"No entries found",buttonClass:"form-select text-start",wrapperClass:"",menuClass:"dropdown-menu p-0",filterPlaceholder:"Search",showDivider:!0,renderOption:null,renderValue:null,data:null,load:null,loadDebounce:250,maxDisplayItems:3,multiValueStyle:"pills",selectionCountClass:"badge bg-secondary",selectionCountTemplate:e=>`${e} selected`,pillClass:"badge text-bg-light border",pillContainerClass:"fxd-pills",clearButtonClass:"btn btn-outline-secondary btn-sm",clearButtonLabel:"Clear selection",clearButtonText:"×",searchClearable:!0,searchClearButtonClass:"btn btn-link btn-sm text-decoration-none",searchClearIcon:"×",searchClearAriaLabel:"Clear search",warnOnMissingBootstrap:!0,bootstrapMajor:5,showCheckmark:!0,checkmarkText:"✓",checkmarkClass:"fxd-checkmark",filter:null};const d=new WeakMap;function p(e){const t={};return Object.entries(e).forEach(([e,n])=>{if(!e.startsWith("fxdsel"))return;const s=e.replace(/^fxdsel/,""),l=(s.charAt(0).toLowerCase()+s.slice(1)).replace(/-([a-z])/g,(e,t)=>t.toUpperCase());t[l]=function(e){if("true"===e)return!0;if("false"===e)return!1;if("null"===e)return null;if("undefined"!==e){if(""!==e&&!Number.isNaN(Number(e)))return Number(e);if(e.startsWith("{")&&e.endsWith("}")||e.startsWith("[")&&e.endsWith("]"))try{return JSON.parse(e)}catch{return e}return e}}(n)}),t}function h(e=document){e.querySelectorAll("select[data-fxd-select], select.fxd-init-select").forEach(e=>{if(d.has(e))return;const t=p(e.dataset),n=new u(e,t);d.set(e,n)})}"undefined"!=typeof document&&document.addEventListener("DOMContentLoaded",()=>{h()});export{u as FxdSelect,h as initFxdSelects};
//# sourceMappingURL=fxd-select.auto.esm.min.js.map
