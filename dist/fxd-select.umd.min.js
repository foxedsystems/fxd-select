!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).FxdSelect={})}(this,function(e){"use strict";function t(e,t){if(!Array.isArray(e))return[];const n=t?.multiple?new Set(Array.from(t.selectedOptions).map(e=>e.value)):new Set([t?.value]);return e.map(e=>{const t=e.value??"";return{value:t,label:e.label??String(t),selected:"boolean"==typeof e.selected?e.selected:n.has(t),disabled:Boolean(e.disabled),group:e.group??null,element:null}})}function n(e,n={}){return Array.isArray(n.data)?t(n.data,e):function(e){const t=[];return e.querySelectorAll("option").forEach(e=>{t.push({value:e.value,label:e.textContent,selected:e.selected,disabled:e.disabled,group:"OPTGROUP"===e.parentElement?.tagName?e.parentElement.label:null,element:e})}),t}(e)}let s=0;function l(e){return s+=1,`${e}-${s}`}function o(e,t,n={}){e.dispatchEvent(new CustomEvent(t,{detail:n,bubbles:!0}))}function a(e,t,n,s=null){const o=s||{};var a,i;if(s?o.menu.innerHTML="":(o.wrapper=document.createElement("div"),o.wrapper.className="dropdown fxd-select",a=o.wrapper,(i=n.wrapperClass)&&i.split(" ").forEach(e=>{e&&a.classList.add(e)}),o.control=document.createElement("div"),o.control.className="d-flex align-items-center gap-1",o.button=document.createElement("button"),o.button.type="button",o.button.className=n.buttonClass,o.button.setAttribute("role","combobox"),o.button.setAttribute("aria-haspopup","listbox"),o.button.setAttribute("aria-expanded","false"),o.control.appendChild(o.button),n.clearable&&(o.clearButton=document.createElement("button"),o.clearButton.type="button",o.clearButton.className=n.clearButtonClass,o.clearButton.setAttribute("aria-label",n.clearButtonLabel),o.clearButton.textContent=n.clearButtonText,o.control.appendChild(o.clearButton)),o.menu=document.createElement("div"),o.menu.className=n.menuClass,o.wrapper.appendChild(o.control),o.wrapper.appendChild(o.menu),e.parentNode.insertBefore(o.wrapper,e.nextSibling)),o.list=document.createElement("div"),o.list.id=o.list.id||l("fxd-list"),o.list.setAttribute("role","listbox"),o.button.setAttribute("aria-controls",o.list.id),n.searchable){const e=document.createElement("div"),t=document.createElement("div"),s=document.createElement("input");if(t.className="form-control form-control-sm w-auto d-flex flex-fill align-items-center p-1 m-1",s.className="form-control p-0 border-0 rounded-0 shadow-none",s.placeholder=n.filterPlaceholder,s.setAttribute("aria-label",n.filterPlaceholder),t.appendChild(s),n.searchClearable){const e=document.createElement("button");e.type="button",e.className=`fxd-search-clear ${n.searchClearButtonClass}`,e.setAttribute("aria-label",n.searchClearAriaLabel),e.textContent=n.searchClearIcon,t.appendChild(e),o.searchClearButton=e}if(e.appendChild(t),o.menu.appendChild(e),o.searchInput=s,n.showDivider){const e=document.createElement("hr");e.className="m-0",o.menu.appendChild(e)}o.noResults=document.createElement("div"),o.noResults.className="no-result text-muted px-2 small d-none",o.noResults.textContent=n.noResultsText,o.menu.appendChild(o.noResults)}n.maxHeight&&"auto"!==n.maxHeight&&(o.list.style.overflowY="auto",o.list.style.maxHeight=n.maxHeight),o.menu.appendChild(o.list),o.optionButtons=[];let r=null;t.forEach(e=>{if(e.group&&e.group!==r){const t=document.createElement("div");t.className="dropdown-header",t.textContent=e.group,t.dataset.group=e.group,o.list.appendChild(t),r=e.group}e.group||(r=null);const t=document.createElement("button");if(t.type="button",t.className="dropdown-item",t.textContent=e.label,t.dataset.value=e.value,t.dataset.group=e.group||"",t.disabled=e.disabled,t.setAttribute("role","option"),t.setAttribute("aria-selected",e.selected?"true":"false"),t.id=l("fxd-opt"),n.renderOption){const s=n.renderOption(e,{selected:e.selected,disabled:e.disabled});s instanceof HTMLElement?(t.innerHTML="",t.appendChild(s)):"string"==typeof s&&(t.innerHTML=s)}e.selected&&t.classList.add("is-selected"),o.optionButtons.push(t),o.list.appendChild(t)}),function(e,t,n,s){if("function"==typeof n.renderValue){const l=n.renderValue(t,s);return l instanceof HTMLElement?(e.button.innerHTML="",void e.button.appendChild(l)):void(e.button.innerHTML=l??"")}const l=t.filter(e=>e.selected);if(0!==l.length)if(s.multiple){if("pills"===n.multiValueStyle){const t=document.createElement("span");t.className=n.pillContainerClass;const s=Math.max(0,n.maxDisplayItems);if(l.slice(0,s).forEach(e=>{const s=document.createElement("span");s.className=n.pillClass,s.textContent=e.label,t.appendChild(s)}),l.length>s){const e=document.createElement("span");e.className=n.selectionCountClass;const s=n.selectionCountTemplate;e.textContent="function"==typeof s?s(l.length):`${l.length} selected`,t.appendChild(e)}return e.button.innerHTML="",void e.button.appendChild(t)}if("count"===n.multiValueStyle){const t=n.selectionCountTemplate,s="function"==typeof t?t(l.length):`${l.length} selected`;return void(e.button.innerHTML=`<span class="${n.selectionCountClass}">${s}</span>`)}if(l.length>n.maxDisplayItems){const t=n.selectionCountTemplate;return void(e.button.textContent="function"==typeof t?t(l.length):`${l.length} selected`)}e.button.textContent=l.map(e=>e.label).join(", ")}else e.button.textContent=l[0].label;else e.button.textContent=n.placeholder}(o,t,n,e);const c=e.disabled;return o.button.disabled=c,o.clearButton&&(o.clearButton.disabled=c),o.searchInput&&(o.searchInput.disabled=c),o.searchClearButton&&(o.searchClearButton.disabled=c),o}function i(e,t){return!e||t.label.toLowerCase().includes(e.toLowerCase())}function r(e){const{selectEl:n,ui:s,options:l,state:a}=e,r=()=>Array.from(s.list.querySelectorAll("button.dropdown-item")).filter(e=>!e.classList.contains("d-none")&&!e.disabled),c=e=>{const t=r();if(0===t.length)return a.focusedIndex=-1,void s.button.removeAttribute("aria-activedescendant");const n=Math.max(0,Math.min(e,t.length-1));t.forEach(e=>e.classList.remove("active"));const l=t[n];l.classList.add("active"),l.scrollIntoView({block:"nearest"}),a.focusedIndex=n,s.button.setAttribute("aria-activedescendant",l.id)},u=()=>{const e=r();if(0===e.length)return;const t=e.findIndex(e=>"true"===e.getAttribute("aria-selected"));c(t>=0?t:0)},d=t=>{n.disabled||(t.preventDefault(),e.toggle(),e.state.open&&(u(),s.searchInput?.select()))},p=t=>{s.wrapper.contains(t.target)||e.close()},h=t=>{const l=t.target.closest("button.dropdown-item");if(l&&!n.disabled&&!l.disabled)if(n.multiple){const e=Array.from(n.options).find(e=>e.value===l.dataset.value);e&&(e.selected=!e.selected),n.dispatchEvent(new Event("change",{bubbles:!0}))}else n.value=l.dataset.value,n.dispatchEvent(new Event("change",{bubbles:!0})),e.close(),s.button.focus()},m=e=>{const t=e.target.closest("button.dropdown-item");if(!t)return;const n=r().indexOf(t);n>=0&&c(n)},b=()=>{e.refresh(),o(n,"fxd:change")};let f=null;const v=async s=>{const o=await(l.load?.(s));if(!Array.isArray(o))return;const a=t(o,n);!function(e,t){const n=new Map;e.innerHTML="",t.forEach(t=>{let s=e;if(t.group){if(!n.has(t.group)){const s=document.createElement("optgroup");s.label=t.group,n.set(t.group,s),e.appendChild(s)}s=n.get(t.group)}const l=document.createElement("option");l.value=t.value,l.textContent=t.label,l.disabled=Boolean(t.disabled),l.selected=Boolean(t.selected),s.appendChild(l)})}(n,a),e.model=a,e.refresh(),e.ui.searchInput&&(e.ui.searchInput.value=s)},E=t=>{const n=t.target.value;if(e.state.query=n,l.load)return f&&clearTimeout(f),void(f=setTimeout(()=>v(n),l.loadDebounce));const o=l.filter||i,a=function(e,t,n){const s=new Map;let l=0;return Array.from(e.children).forEach(e=>{if(e.classList.contains("dropdown-header"))return void s.set(e.dataset.group||"",{header:e,visible:0});if(!e.matches("button.dropdown-item"))return;const o={label:e.textContent},a=n(t,o);e.classList.toggle("d-none",!a),a||(l+=1);const i=e.dataset.group||"";s.has(i)&&a&&(s.get(i).visible+=1)}),s.forEach(({header:e,visible:t})=>{e.classList.toggle("d-none",0===t)}),l}(s.list,n,o);s.noResults&&s.noResults.classList.toggle("d-none",a<s.list.children.length),u()},g=t=>{if(n.disabled)return;const l=t.key;if(!e.state.open&&["ArrowDown","ArrowUp","Enter"," "].includes(l))return t.preventDefault(),e.open(),u(),void s.searchInput?.select();if(e.state.open){if("Escape"===l)return t.preventDefault(),e.close(),void s.button.focus();if("Enter"===l){t.preventDefault();const e=r()[a.focusedIndex];return void(e&&e.click())}if(" "===l){t.preventDefault();const e=r()[a.focusedIndex];return void(e&&e.click())}if(["ArrowDown","ArrowUp","Home","End"].includes(l)){t.preventDefault();const e=r();if(0===e.length)return;if("Home"===l)return void c(0);if("End"===l)return void c(e.length-1);const n="ArrowDown"===l?1:-1;c(a.focusedIndex+n)}}},C=t=>{t.preventDefault(),e.clear()},x=()=>{s.searchInput&&(s.searchInput.value="",s.searchInput.dispatchEvent(new Event("input")),s.searchInput.select())};return s.button.addEventListener("click",d),s.list.addEventListener("click",h),s.list.addEventListener("mousemove",m),document.addEventListener("click",p),n.addEventListener("change",b),s.searchInput?.addEventListener("input",E),s.searchClearButton?.addEventListener("click",x),s.wrapper.addEventListener("keydown",g),s.clearButton?.addEventListener("click",C),()=>{s.button.removeEventListener("click",d),s.list.removeEventListener("click",h),s.list.removeEventListener("mousemove",m),document.removeEventListener("click",p),n.removeEventListener("change",b),s.searchInput?.removeEventListener("input",E),s.searchClearButton?.removeEventListener("click",x),s.wrapper.removeEventListener("keydown",g),s.clearButton?.removeEventListener("click",C)}}class c{constructor(e,t={}){if(!e||"SELECT"!==e.tagName)throw new Error("FxdSelect requires a <select> element");this.selectEl=e,this.options={...c.defaults,...t},this.state={open:!1,query:"",focusedIndex:-1},this.model=n(this.selectEl,this.options),this.ui=a(this.selectEl,this.model,this.options),this.cleanup=r(this),this.selectEl.classList.add("d-none"),this.options.warnOnMissingBootstrap&&function(e=5){if("undefined"==typeof window||"undefined"==typeof document)return;const t=getComputedStyle(document.documentElement).getPropertyValue("--bs-body-color").trim(),n=document.createElement("div");n.className="dropdown-menu",n.style.position="absolute",n.style.visibility="hidden",document.body.appendChild(n);const s=getComputedStyle(n);document.body.removeChild(n),t.length>0&&"absolute"===s.position||console.warn(`fxd-select: Bootstrap ${e}.x styles not detected. The component will still work, but you should provide your own styles.`)}(this.options.bootstrapMajor),o(this.selectEl,"fxd:init")}_syncOpenState(e){this.state.open=e,e?(this.ui.wrapper.classList.add("show"),this.ui.menu.classList.add("show"),this.ui.button.setAttribute("aria-expanded","true")):(this.ui.wrapper.classList.remove("show"),this.ui.menu.classList.remove("show"),this.ui.button.setAttribute("aria-expanded","false"),this.ui.button.removeAttribute("aria-activedescendant"),this.state.focusedIndex=-1)}open(){this.state.open||(this._syncOpenState(!0),o(this.selectEl,"fxd:open"))}close(){this.state.open&&(this._syncOpenState(!1),o(this.selectEl,"fxd:close"))}toggle(){this.state.open?this.close():this.open()}refresh(){const e=this.state.open;this.cleanup?.(),this.model=n(this.selectEl,this.options),this.ui=a(this.selectEl,this.model,this.options,this.ui),this.cleanup=r(this),this._syncOpenState(e),this.ui.searchInput&&this.state.query&&(this.ui.searchInput.value=this.state.query,this.ui.searchInput.dispatchEvent(new Event("input"))),o(this.selectEl,"fxd:refresh")}destroy(){this.cleanup?.(),this.ui.wrapper.remove(),this.selectEl.classList.remove("d-none"),o(this.selectEl,"fxd:destroy")}getValue(){return this.selectEl.value}setValue(e){this.selectEl.value=e,this.selectEl.dispatchEvent(new Event("change",{bubbles:!0}))}clear(){this.selectEl.multiple?Array.from(this.selectEl.options).forEach(e=>{e.selected=!1}):this.selectEl.value="",this.selectEl.dispatchEvent(new Event("change",{bubbles:!0}))}}c.defaults={searchable:!0,clearable:!1,maxHeight:"12em",placeholder:"Select...",noResultsText:"No entries found",buttonClass:"form-select text-start",wrapperClass:"",menuClass:"dropdown-menu p-0",filterPlaceholder:"Search",showDivider:!0,renderOption:null,renderValue:null,data:null,load:null,loadDebounce:250,maxDisplayItems:3,multiValueStyle:"pills",selectionCountClass:"badge bg-secondary",selectionCountTemplate:e=>`${e} selected`,pillClass:"badge text-bg-light border",pillContainerClass:"fxd-pills",clearButtonClass:"btn btn-outline-secondary btn-sm",clearButtonLabel:"Clear selection",clearButtonText:"×",searchClearable:!0,searchClearButtonClass:"btn btn-link btn-sm text-decoration-none",searchClearIcon:"×",searchClearAriaLabel:"Clear search",warnOnMissingBootstrap:!0,bootstrapMajor:5,filter:null},e.FxdSelect=c});
//# sourceMappingURL=fxd-select.umd.min.js.map
