{"version":3,"file":"fxd-select.esm.min.js","sources":["../src/core/model.js","../src/core/utils.js","../src/core/render.js","../src/core/filter.js","../src/core/events.js","../src/core/FxdSelect.js"],"sourcesContent":["export function parseSelect(selectEl) {\n  const options = [];\n\n  selectEl.querySelectorAll('option').forEach((opt) => {\n    options.push({\n      value: opt.value,\n      label: opt.textContent,\n      selected: opt.selected,\n      disabled: opt.disabled,\n      group: opt.parentElement?.tagName === 'OPTGROUP' ? opt.parentElement.label : null,\n      element: opt,\n    });\n  });\n\n  return options;\n}\n\nexport function normalizeOptions(data, selectEl) {\n  if (!Array.isArray(data)) return [];\n\n  const selectedValues = selectEl?.multiple\n    ? new Set(Array.from(selectEl.selectedOptions).map((opt) => opt.value))\n    : new Set([selectEl?.value]);\n\n  return data.map((item) => {\n    const value = item.value ?? '';\n    const label = item.label ?? String(value);\n    const selected = typeof item.selected === 'boolean'\n      ? item.selected\n      : selectedValues.has(value);\n\n    return {\n      value,\n      label,\n      selected,\n      disabled: Boolean(item.disabled),\n      group: item.group ?? null,\n      element: null,\n    };\n  });\n}\n\nexport function buildModel(selectEl, options = {}) {\n  if (Array.isArray(options.data)) {\n    return normalizeOptions(options.data, selectEl);\n  }\n  return parseSelect(selectEl);\n}\n\nexport function syncSelectWithModel(selectEl, model) {\n  const currentGroups = new Map();\n  selectEl.innerHTML = '';\n\n  model.forEach((opt) => {\n    let parent = selectEl;\n    if (opt.group) {\n      if (!currentGroups.has(opt.group)) {\n        const groupEl = document.createElement('optgroup');\n        groupEl.label = opt.group;\n        currentGroups.set(opt.group, groupEl);\n        selectEl.appendChild(groupEl);\n      }\n      parent = currentGroups.get(opt.group);\n    }\n\n    const optionEl = document.createElement('option');\n    optionEl.value = opt.value;\n    optionEl.textContent = opt.label;\n    optionEl.disabled = Boolean(opt.disabled);\n    optionEl.selected = Boolean(opt.selected);\n    parent.appendChild(optionEl);\n  });\n}\n","let idCounter = 0;\n\nexport function createId(prefix) {\n  idCounter += 1;\n  return `${prefix}-${idCounter}`;\n}\n\nexport function addClasses(el, classString) {\n  if (!classString) return;\n  classString.split(' ').forEach((c) => {\n    if (c) el.classList.add(c);\n  });\n}\n\nexport function dispatchEvent(el, name, detail = {}) {\n  el.dispatchEvent(new CustomEvent(name, { detail, bubbles: true }));\n}\r\n","import { addClasses, createId } from './utils.js';\n\nfunction updateButtonLabel(ui, model, options, selectEl) {\n  if (typeof options.renderValue === 'function') {\n    const rendered = options.renderValue(model, selectEl);\n    if (rendered instanceof HTMLElement) {\n      ui.button.innerHTML = '';\n      ui.button.appendChild(rendered);\n      return;\n    }\n    ui.button.innerHTML = rendered ?? '';\n    return;\n  }\n\n  const selected = model.filter((opt) => opt.selected);\n  if (selected.length === 0) {\n    ui.button.textContent = options.placeholder;\n    return;\n  }\n\n  if (selectEl.multiple) {\n    if (selected.length > options.maxDisplayItems) {\n      ui.button.textContent = `${selected.length} selected`;\n      return;\n    }\n    ui.button.textContent = selected.map((opt) => opt.label).join(', ');\n    return;\n  }\n\n  ui.button.textContent = selected[0].label;\n}\n\nexport function render(selectEl, model, options, existingUi = null) {\n  const ui = existingUi || {};\n\n  if (!existingUi) {\n    ui.wrapper = document.createElement('div');\n    ui.wrapper.className = 'dropdown fxd-select';\n    addClasses(ui.wrapper, options.wrapperClass);\n\n    ui.control = document.createElement('div');\n    ui.control.className = 'd-flex align-items-center gap-1';\n\n    ui.button = document.createElement('button');\n    ui.button.type = 'button';\n    ui.button.className = options.buttonClass;\n    ui.button.setAttribute('role', 'combobox');\n    ui.button.setAttribute('aria-haspopup', 'listbox');\n    ui.button.setAttribute('aria-expanded', 'false');\n\n    ui.control.appendChild(ui.button);\n\n    if (options.clearable) {\n      ui.clearButton = document.createElement('button');\n      ui.clearButton.type = 'button';\n      ui.clearButton.className = options.clearButtonClass;\n      ui.clearButton.setAttribute('aria-label', options.clearButtonLabel);\n      ui.clearButton.textContent = 'Ã—';\n      ui.control.appendChild(ui.clearButton);\n    }\n\n    ui.menu = document.createElement('div');\n    ui.menu.className = options.menuClass;\n\n    ui.wrapper.appendChild(ui.control);\n    ui.wrapper.appendChild(ui.menu);\n\n    selectEl.parentNode.insertBefore(ui.wrapper, selectEl.nextSibling);\n  } else {\n    ui.menu.innerHTML = '';\n  }\n\n  ui.list = document.createElement('div');\n  ui.list.id = ui.list.id || createId('fxd-list');\n  ui.list.setAttribute('role', 'listbox');\n\n  ui.button.setAttribute('aria-controls', ui.list.id);\n\n  if (options.searchable) {\n    const searchWrapper = document.createElement('div');\n    const searchContainer = document.createElement('div');\n    const searchInput = document.createElement('input');\n\n    searchContainer.className = 'form-control form-control-sm w-auto d-flex flex-fill align-items-center p-1 m-1';\n    searchInput.className = 'form-control p-0 border-0 rounded-0 shadow-none';\n    searchInput.placeholder = options.filterPlaceholder;\n    searchInput.setAttribute('aria-label', options.filterPlaceholder);\n\n    searchContainer.appendChild(searchInput);\n    searchWrapper.appendChild(searchContainer);\n    ui.menu.appendChild(searchWrapper);\n\n    ui.searchInput = searchInput;\n\n    if (options.showDivider) {\n      const divider = document.createElement('hr');\n      divider.className = 'm-0';\n      ui.menu.appendChild(divider);\n    }\n\n    ui.noResults = document.createElement('div');\n    ui.noResults.className = 'no-result text-muted px-2 small d-none';\n    ui.noResults.textContent = options.noResultsText;\n    ui.menu.appendChild(ui.noResults);\n  }\n\n  if (options.maxHeight && options.maxHeight !== 'auto') {\n    ui.list.style.overflowY = 'auto';\n    ui.list.style.maxHeight = options.maxHeight;\n  }\n\n  ui.menu.appendChild(ui.list);\n\n  ui.optionButtons = [];\n\n  let currentGroup = null;\n  model.forEach((opt) => {\n    if (opt.group && opt.group !== currentGroup) {\n      const header = document.createElement('div');\n      header.className = 'dropdown-header';\n      header.textContent = opt.group;\n      header.dataset.group = opt.group;\n      ui.list.appendChild(header);\n      currentGroup = opt.group;\n    }\n\n    if (!opt.group) {\n      currentGroup = null;\n    }\n\n    const item = document.createElement('button');\n    item.type = 'button';\n    item.className = 'dropdown-item';\n    item.textContent = opt.label;\n    item.dataset.value = opt.value;\n    item.dataset.group = opt.group || '';\n    item.disabled = opt.disabled;\n    item.setAttribute('role', 'option');\n    item.setAttribute('aria-selected', opt.selected ? 'true' : 'false');\n    item.id = createId('fxd-opt');\n\n    if (options.renderOption) {\n      const rendered = options.renderOption(opt, { selected: opt.selected, disabled: opt.disabled });\n      if (rendered instanceof HTMLElement) {\n        item.innerHTML = '';\n        item.appendChild(rendered);\n      } else if (typeof rendered === 'string') {\n        item.innerHTML = rendered;\n      }\n    }\n\n    if (opt.selected) {\n      item.classList.add('is-selected');\n    }\n\n    ui.optionButtons.push(item);\n    ui.list.appendChild(item);\n  });\n\n  updateButtonLabel(ui, model, options, selectEl);\n\n  return ui;\n}\n","export function defaultFilter(query, option) {\n  if (!query) return true;\n  return option.label.toLowerCase().includes(query.toLowerCase());\n}\n\nexport function applyFilter(listEl, query, filterFn) {\n  const groupState = new Map();\n  let hidden = 0;\n\n  Array.from(listEl.children).forEach((item) => {\n    if (item.classList.contains('dropdown-header')) {\n      groupState.set(item.dataset.group || '', { header: item, visible: 0 });\n      return;\n    }\n\n    if (!item.matches('button.dropdown-item')) return;\n\n    const option = { label: item.textContent };\n    const show = filterFn(query, option);\n    item.classList.toggle('d-none', !show);\n    if (!show) hidden += 1;\n\n    const groupKey = item.dataset.group || '';\n    if (groupState.has(groupKey) && show) {\n      groupState.get(groupKey).visible += 1;\n    }\n  });\n\n  groupState.forEach(({ header, visible }) => {\n    header.classList.toggle('d-none', visible === 0);\n  });\n\n  return hidden;\n}\r\n","import { defaultFilter, applyFilter } from './filter.js';\nimport { normalizeOptions, syncSelectWithModel } from './model.js';\nimport { dispatchEvent } from './utils.js';\n\nexport function bindEvents(fxd) {\n  const { selectEl, ui, options, state } = fxd;\n\n  const getVisibleOptions = () => (\n    Array.from(ui.list.querySelectorAll('button.dropdown-item')).filter(\n      (item) => !item.classList.contains('d-none') && !item.disabled\n    )\n  );\n\n  const setFocusedIndex = (index) => {\n    const optionsList = getVisibleOptions();\n    if (optionsList.length === 0) {\n      state.focusedIndex = -1;\n      ui.button.removeAttribute('aria-activedescendant');\n      return;\n    }\n\n    const clamped = Math.max(0, Math.min(index, optionsList.length - 1));\n    optionsList.forEach((item) => item.classList.remove('active'));\n\n    const focused = optionsList[clamped];\n    focused.classList.add('active');\n    focused.scrollIntoView({ block: 'nearest' });\n\n    state.focusedIndex = clamped;\n    ui.button.setAttribute('aria-activedescendant', focused.id);\n  };\n\n  const focusSelectedOrFirst = () => {\n    const optionsList = getVisibleOptions();\n    if (optionsList.length === 0) return;\n\n    const selectedIndex = optionsList.findIndex(\n      (item) => item.getAttribute('aria-selected') === 'true'\n    );\n\n    setFocusedIndex(selectedIndex >= 0 ? selectedIndex : 0);\n  };\n\n  const onButtonClick = (e) => {\n    e.preventDefault();\n    fxd.toggle();\n    if (fxd.state.open) {\n      focusSelectedOrFirst();\n      ui.searchInput?.focus();\n    }\n  };\n\n  const onDocumentClick = (e) => {\n    if (!ui.wrapper.contains(e.target)) {\n      fxd.close();\n    }\n  };\n\n  const onItemClick = (e) => {\n    const item = e.target.closest('button.dropdown-item');\n    if (!item) return;\n    if (selectEl.multiple) {\n      const option = Array.from(selectEl.options).find((opt) => opt.value === item.dataset.value);\n      if (option) {\n        option.selected = !option.selected;\n      }\n      selectEl.dispatchEvent(new Event('change', { bubbles: true }));\n    } else {\n      selectEl.value = item.dataset.value;\n      selectEl.dispatchEvent(new Event('change', { bubbles: true }));\n      fxd.close();\n      ui.button.focus();\n    }\n  };\n\n  const onItemHover = (e) => {\n    const item = e.target.closest('button.dropdown-item');\n    if (!item) return;\n\n    const optionsList = getVisibleOptions();\n    const idx = optionsList.indexOf(item);\n    if (idx >= 0) setFocusedIndex(idx);\n  };\n\n  const onSelectChange = () => {\n    fxd.refresh();\n    dispatchEvent(selectEl, 'fxd:change');\n  };\n\n  let loadTimer = null;\n  const runLoad = async (query) => {\n    const data = await options.load?.(query);\n    if (!Array.isArray(data)) return;\n    const model = normalizeOptions(data, selectEl);\n    syncSelectWithModel(selectEl, model);\n    fxd.model = model;\n    fxd.refresh();\n    if (fxd.ui.searchInput) {\n      fxd.ui.searchInput.value = query;\n    }\n  };\n\n  const onFilterInput = (e) => {\n    const query = e.target.value;\n    fxd.state.query = query;\n\n    if (options.load) {\n      if (loadTimer) clearTimeout(loadTimer);\n      loadTimer = setTimeout(() => runLoad(query), options.loadDebounce);\n      return;\n    }\n\n    const filterFn = options.filter || defaultFilter;\n    const hiddenCount = applyFilter(ui.list, query, filterFn);\n\n    if (ui.noResults) {\n      ui.noResults.classList.toggle('d-none', hiddenCount < ui.list.children.length);\n    }\n\n    focusSelectedOrFirst();\n  };\n\n  const onKeyDown = (e) => {\n    const key = e.key;\n    const openKeys = ['ArrowDown', 'ArrowUp', 'Enter', ' '];\n    const navKeys = ['ArrowDown', 'ArrowUp', 'Home', 'End'];\n\n    if (!fxd.state.open && openKeys.includes(key)) {\n      e.preventDefault();\n      fxd.open();\n      focusSelectedOrFirst();\n      return;\n    }\n\n    if (!fxd.state.open) return;\n\n    if (key === 'Escape') {\n      e.preventDefault();\n      fxd.close();\n      ui.button.focus();\n      return;\n    }\n\n    if (key === 'Enter') {\n      e.preventDefault();\n      const optionsList = getVisibleOptions();\n      const focused = optionsList[state.focusedIndex];\n      if (focused) {\n        focused.click();\n      }\n      return;\n    }\n\n    if (navKeys.includes(key)) {\n      e.preventDefault();\n      const optionsList = getVisibleOptions();\n      if (optionsList.length === 0) return;\n\n      if (key === 'Home') {\n        setFocusedIndex(0);\n        return;\n      }\n\n      if (key === 'End') {\n        setFocusedIndex(optionsList.length - 1);\n        return;\n      }\n\n      const delta = key === 'ArrowDown' ? 1 : -1;\n      setFocusedIndex(state.focusedIndex + delta);\n    }\n  };\n\n  const onClearClick = (e) => {\n    e.preventDefault();\n    fxd.clear();\n  };\n\n  ui.button.addEventListener('click', onButtonClick);\n  ui.list.addEventListener('click', onItemClick);\n  ui.list.addEventListener('mousemove', onItemHover);\n  document.addEventListener('click', onDocumentClick);\n  selectEl.addEventListener('change', onSelectChange);\n  ui.searchInput?.addEventListener('input', onFilterInput);\n  ui.wrapper.addEventListener('keydown', onKeyDown);\n  ui.clearButton?.addEventListener('click', onClearClick);\n\n  return () => {\n    ui.button.removeEventListener('click', onButtonClick);\n    ui.list.removeEventListener('click', onItemClick);\n    ui.list.removeEventListener('mousemove', onItemHover);\n    document.removeEventListener('click', onDocumentClick);\n    selectEl.removeEventListener('change', onSelectChange);\n    ui.searchInput?.removeEventListener('input', onFilterInput);\n    ui.wrapper.removeEventListener('keydown', onKeyDown);\n    ui.clearButton?.removeEventListener('click', onClearClick);\n  };\n}\n","import { buildModel } from './model.js';\nimport { render } from './render.js';\nimport { bindEvents } from './events.js';\nimport { dispatchEvent } from './utils.js';\n\nexport class FxdSelect {\n  constructor(selectEl, options = {}) {\n    if (!selectEl || selectEl.tagName !== 'SELECT') {\n      throw new Error('FxdSelect requires a <select> element');\n    }\n\n    this.selectEl = selectEl;\n    this.options = { ...FxdSelect.defaults, ...options };\n    this.state = {\n      open: false,\n      query: '',\n      focusedIndex: -1,\n    };\n\n    this.model = buildModel(this.selectEl, this.options);\n    this.ui = render(this.selectEl, this.model, this.options);\n    this.cleanup = bindEvents(this);\n\n    this.selectEl.classList.add('d-none');\n\n    dispatchEvent(this.selectEl, 'fxd:init');\n  }\n\n  _syncOpenState(open) {\n    this.state.open = open;\n    if (open) {\n      this.ui.wrapper.classList.add('show');\n      this.ui.menu.classList.add('show');\n      this.ui.button.setAttribute('aria-expanded', 'true');\n    } else {\n      this.ui.wrapper.classList.remove('show');\n      this.ui.menu.classList.remove('show');\n      this.ui.button.setAttribute('aria-expanded', 'false');\n      this.ui.button.removeAttribute('aria-activedescendant');\n      this.state.focusedIndex = -1;\n    }\n  }\n\n  open() {\n    if (this.state.open) return;\n    this._syncOpenState(true);\n    dispatchEvent(this.selectEl, 'fxd:open');\n  }\n\n  close() {\n    if (!this.state.open) return;\n    this._syncOpenState(false);\n    dispatchEvent(this.selectEl, 'fxd:close');\n  }\n\n  toggle() {\n    if (this.state.open) this.close();\n    else this.open();\n  }\n\n  refresh() {\n    const wasOpen = this.state.open;\n    this.cleanup?.();\n    this.model = buildModel(this.selectEl, this.options);\n    this.ui = render(this.selectEl, this.model, this.options, this.ui);\n    this.cleanup = bindEvents(this);\n    this._syncOpenState(wasOpen);\n    if (this.ui.searchInput && this.state.query) {\n      this.ui.searchInput.value = this.state.query;\n      this.ui.searchInput.dispatchEvent(new Event('input'));\n    }\n    dispatchEvent(this.selectEl, 'fxd:refresh');\n  }\n\n  destroy() {\n    this.cleanup?.();\n    this.ui.wrapper.remove();\n    this.selectEl.classList.remove('d-none');\n    dispatchEvent(this.selectEl, 'fxd:destroy');\n  }\n\n  getValue() {\n    return this.selectEl.value;\n  }\n\n  setValue(value) {\n    this.selectEl.value = value;\n    this.selectEl.dispatchEvent(new Event('change', { bubbles: true }));\n  }\n\n  clear() {\n    if (this.selectEl.multiple) {\n      Array.from(this.selectEl.options).forEach((opt) => {\n        opt.selected = false;\n      });\n    } else {\n      this.selectEl.value = '';\n    }\n    this.selectEl.dispatchEvent(new Event('change', { bubbles: true }));\n  }\n}\n\nFxdSelect.defaults = {\n  searchable: true,\n  clearable: false,\n  maxHeight: '12em',\n  placeholder: 'Select...',\n  noResultsText: 'No entries found',\n  buttonClass: 'form-select text-start',\n  wrapperClass: '',\n  menuClass: 'dropdown-menu p-0',\n  filterPlaceholder: 'Search',\n  showDivider: true,\n  renderOption: null,\n  renderValue: null,\n  data: null,\n  load: null,\n  loadDebounce: 250,\n  maxDisplayItems: 3,\n  clearButtonClass: 'btn btn-outline-secondary btn-sm',\n  clearButtonLabel: 'Clear selection',\n  filter: null,\n};\n"],"names":["normalizeOptions","data","selectEl","Array","isArray","selectedValues","multiple","Set","from","selectedOptions","map","opt","value","item","label","String","selected","has","disabled","Boolean","group","element","buildModel","options","querySelectorAll","forEach","push","textContent","parentElement","tagName","parseSelect","idCounter","createId","prefix","dispatchEvent","el","name","detail","CustomEvent","bubbles","render","model","existingUi","ui","classString","menu","innerHTML","wrapper","document","createElement","className","wrapperClass","split","c","classList","add","control","button","type","buttonClass","setAttribute","appendChild","clearable","clearButton","clearButtonClass","clearButtonLabel","menuClass","parentNode","insertBefore","nextSibling","list","id","searchable","searchWrapper","searchContainer","searchInput","placeholder","filterPlaceholder","showDivider","divider","noResults","noResultsText","maxHeight","style","overflowY","optionButtons","currentGroup","header","dataset","renderOption","rendered","HTMLElement","renderValue","filter","length","maxDisplayItems","join","updateButtonLabel","defaultFilter","query","option","toLowerCase","includes","bindEvents","fxd","state","getVisibleOptions","contains","setFocusedIndex","index","optionsList","focusedIndex","removeAttribute","clamped","Math","max","min","remove","focused","scrollIntoView","block","focusSelectedOrFirst","selectedIndex","findIndex","getAttribute","onButtonClick","e","preventDefault","toggle","open","focus","onDocumentClick","target","close","onItemClick","closest","find","Event","onItemHover","idx","indexOf","onSelectChange","refresh","loadTimer","runLoad","async","load","currentGroups","Map","parent","groupEl","set","get","optionEl","syncSelectWithModel","onFilterInput","clearTimeout","setTimeout","loadDebounce","filterFn","hiddenCount","listEl","groupState","hidden","children","visible","matches","show","groupKey","applyFilter","onKeyDown","key","click","delta","onClearClick","clear","addEventListener","removeEventListener","FxdSelect","constructor","Error","this","defaults","cleanup","_syncOpenState","wasOpen","destroy","getValue","setValue"],"mappings":"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"}